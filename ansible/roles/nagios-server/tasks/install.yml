- name: Install dependencies
  yum: "name={{ packages }} state=installed"

- include: common.yml

- name: Remove Nagios web password protection
  lineinfile:
    dest: "{{ config_files.web }}"
    regexp: "{{ item }}"
    state: absent
  with_items:
    - 'AuthName "Nagios Access"'
    - 'AuthType Basic'
    - 'AuthUserFile /etc/nagios/passwd'
    - 'Require valid-user'
  when: nagios_server_nopasswd is defined and nagios_server_nopasswd

- name: Remove Nagios service authentication
  lineinfile:
    dest: "{{ config_files.cgi }}"
    regexp: "^use_authentication="
    line: "use_authentication=0"
  when: nagios_server_nopasswd is defined and nagios_server_nopasswd
  notify: Nagios restart

- name: Start & enable Nagios
  service: name=nagios enabled=yes state=started
